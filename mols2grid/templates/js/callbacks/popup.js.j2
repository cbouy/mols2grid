// Prerequisite JavaScript code.
// prettier-ignore
{{ js }}

// HTML template for the popup.
let html = `
<div id="m2g-modal" tabindex="-1" style="{{ style }}">

    <div class="m2g-modal-header">
        {% if title %}<h2>{{ title }}</h2>{% endif %}
        {% if subtitle %}<p>{{ subtitle }}</p>{% endif %}
        <button class="close">&times;</button>
    </div>

    <div class="m2g-modal-body">
        {% if svg %}<div class="svg-wrap">{{ svg }}</div>{% endif %}
        {{ html }}
    </div>

</div>
`

// Create container element where the popup will be inserted.
if ($("{{ identifier }} #m2g-modal-container").elements.length === 0) {
    $("{{ identifier }}").append('<span id="m2g-modal-container"></span>')
}

// Insert the code inside the container element.
let $modal = $("{{ identifier }} #m2g-modal-container")
$modal.elements[0].innerHTML = html

// Show modal.
setTimeout(() => {
    $modal.addClass("show")
}, 0)

// Hide modal on close / ESC key.
$modal.on("click", ev => {
    if (ev.target.id == "m2g-modal-container" || ev.target.className === "close") {
        closeModal()
    }
})
$(document).on("keydown", ev => {
    if (ev.code === "Escape") {
        closeModal()
        ev.preventDefault()
    }
})
function closeModal() {
    $modal.removeClass("show")
    setTimeout(function () {
        $modal.elements[0].remove()
    }, 160)
}
